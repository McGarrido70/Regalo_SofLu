<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>El Universo de Sofi</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        /* --- ESTILOS GENERALES --- */
        body { margin: 0; background-color: #050505; color: white; font-family: 'Segoe UI', sans-serif; overflow-x: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        /* PANTALLA DE INICIO */
        #start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 5000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: opacity 1s;
        }
        #start-btn {
            padding: 15px 40px; font-size: 1.5rem; background: transparent;
            color: #d400ff; border: 2px solid #d400ff; border-radius: 50px;
            cursor: pointer; transition: 0.3s; box-shadow: 0 0 20px rgba(212, 0, 255, 0.4);
        }
        #start-btn:hover { background: #d400ff; color: white; transform: scale(1.1); }

        /* CONTENEDOR 3D */
        #scene-container {
            width: 85%; height: 450px; margin: 40px auto; position: relative;
            border: 1px solid #333; border-radius: 15px; overflow: hidden;
            box-shadow: 0 0 30px rgba(212, 0, 255, 0.15); cursor: grab;
        }
        #scene-container:active { cursor: grabbing; }
        .instruction { text-align: center; color: #888; font-size: 0.9rem; margin-top: -30px; margin-bottom: 40px; }

        /* SECCIONES TEXTO */
        .bottom-section { display: flex; justify-content: space-between; width: 85%; margin: 0 auto 50px auto; gap: 20px; flex-wrap: wrap;}
        .card { background: #0f0f0f; border: 1px solid #222; padding: 25px; width: 45%; border-radius: 15px; min-width: 300px; flex-grow: 1; }
        h2 { color: #d400ff; margin-top: 0; font-size: 1.4rem; }
        p { line-height: 1.6; color: #ccc; font-size: 0.95rem; }

        /* CALENDARIO */
        .calendar-section { width: 85%; margin: 0 auto 100px auto; background: #0f0f0f; border: 1px solid #222; border-radius: 15px; padding: 20px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-nav { background: #222; color: #d400ff; border: 1px solid #d400ff; padding: 5px 15px; border-radius: 5px; cursor: pointer; }
        .days-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .day-cell { background: #1a1a1a; padding: 10px; border-radius: 5px; cursor: pointer; min-height: 40px; transition: 0.2s;}
        .day-cell:hover { background: #2a2a2a; border-color:#555; }
        .day-cell.today { border: 1px solid #d400ff; color: #d400ff; font-weight: bold;}
        .has-note::after { content: '‚òÖ'; display: block; color: #ffd700; font-size: 0.8rem; position: absolute; top: 2px; right: 2px;}

        /* UKELELE */
        .uke-section {
            width: 90%; max-width: 550px; margin: 0 auto 100px auto;
            text-align: center; background: #2a1b0e; padding: 20px;
            border-radius: 20px; border: 4px solid #4a3018;
            box-shadow: 0 0 30px rgba(0,0,0,0.5); 
            touch-action: none;
        }
        .chord-selectors { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .chord-btn {
            background: #4a3018; color: #dcb; border: 1px solid #6b4c2e;
            padding: 8px 12px; border-radius: 6px; cursor: pointer; transition: 0.2s; min-width: 40px;
        }
        .chord-btn.active { background: #d400ff; color: white; border-color: #fff; transform: scale(1.1); }
        
        .fretboard {
            position: relative; height: 180px; 
            background: linear-gradient(to bottom, #2c1e12, #1a0b05);
            border: 4px solid #4a3018; border-radius: 8px;
            display: flex; flex-direction: column; justify-content: space-evenly;
            overflow: hidden; cursor: pointer;
        }
        .fret-line { position: absolute; top:0; height:100%; width:2px; background:#553a22; }
        .string { position: relative; width: 100%; height: 45px; display: flex; align-items: center; z-index: 10; }
        .string::before { content:''; position: absolute; left:0; right:0; height:2px; background: rgba(255,255,255,0.5); box-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .string.vibrating::before { background: #d400ff; height: 3px; box-shadow: 0 0 10px #d400ff; }
        .finger-dot { position: absolute; width: 16px; height: 16px; background: #d400ff; border-radius: 50%; display: none; transform: translate(-50%, -50%); top: 50%; box-shadow: 0 0 5px #fff; z-index: 20; }

        /* GA-TAROT */
        .tarot-section {
            width: 85%; margin: 0 auto 150px auto;
            text-align: center; background: linear-gradient(135deg, #1a0b2e 0%, #000 100%);
            padding: 40px 20px; border-radius: 20px; border: 1px solid #4a3068;
            box-shadow: 0 0 40px rgba(74, 48, 104, 0.4);
        }
        .tarot-container {
            perspective: 1000px;
            width: 250px; height: 380px; margin: 30px auto; cursor: pointer;
        }
        .tarot-card {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; transition: transform 0.8s;
            border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.8);
        }
        .tarot-card.flipped { transform: rotateY(180deg); }
        
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 15px;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column; overflow: hidden;
        }
        .card-back {
            background: linear-gradient(45deg, #111, #222);
            border: 2px solid #d400ff;
            background-image: repeating-linear-gradient(45deg, #1a1a1a 25%, transparent 25%, transparent 75%, #1a1a1a 75%, #1a1a1a), repeating-linear-gradient(45deg, #1a1a1a 25%, #0f0f0f 25%, #0f0f0f 75%, #1a1a1a 75%, #1a1a1a);
            background-position: 0 0, 10px 10px; background-size: 20px 20px;
        }
        .card-back::after { content: 'üêæ'; font-size: 4rem; color: #d400ff; text-shadow: 0 0 20px #d400ff; animation: pulse 2s infinite; }
        
        .card-front {
            background: #0f0f0f; border: 2px solid #d400ff;
            transform: rotateY(180deg); padding: 15px; box-sizing: border-box;
        }
        
        .tarot-image-container { 
            width: 180px; height: 180px; margin-bottom: 15px; 
            border-radius: 10px; overflow: hidden; 
            border: 2px solid #d400ff; box-shadow: 0 0 15px rgba(212,0,255,0.4); 
        }
        .tarot-image-actual { width: 100%; height: 100%; object-fit: cover; }

        .tarot-name { font-size: 1.4rem; color: #d400ff; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .tarot-meaning { font-size: 0.9rem; color: #ccc; line-height: 1.4; padding: 0 5px; }
        
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.5; transform: scale(1); } }

        /* MODAL Y PLAYER */
        #noteModal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; justify-content:center; align-items:center; }
        .modal-content { background:#151515; padding:30px; border-radius:10px; width:300px; border:1px solid #d400ff; text-align:center; }
        textarea { width:100%; height:100px; background:#222; color:white; border:1px solid #444; margin:15px 0; padding:10px; }
        
        #music-player { position: fixed; bottom: 20px; left: 20px; background: rgba(15, 15, 15, 0.95); border: 1px solid #d400ff; padding: 10px 20px; border-radius: 50px; z-index: 1000; display: flex; align-items: center; gap: 15px; }
        .controls button { background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem; }
        .song-info { font-size: 0.85rem; max-width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #d400ff; }

        @media (max-width: 768px) {
            .bottom-section { flex-direction: column; }
            .card, .calendar-section, .uke-section, .tarot-section { width: 95%; }
            #music-player { left: 2.5%; width: 95%; justify-content: space-between; }
        }
    </style>
</head>
<body>

    <div id="start-screen">
        <h1 style="color:white; margin-bottom: 30px;">El Universo de Sofi ‚ú®</h1>
        <button id="start-btn" onclick="startExperience()">Entrar</button>
    </div>

    <div id="scene-container"></div>
    <p class="instruction">‚ú® Gira y busca tu nombre escondido (¬°Puedes hacer Zoom!) ‚ú®</p>

    <div class="bottom-section">
        <div class="card">
            <h2>Bienvenida</h2>
            <p>Este es tu rinc√≥n especial. Arriba tienes un universo realista para explorar.</p>
            <p>Abajo, m√∫sica, un ukelele para practicar y el Gran Or√°culo Ga-tarot.</p>
        </div>
        <div class="card">
            <h2>Calendario en la Nube</h2>
            <p>Haz clic en cualquier d√≠a. Lo que escribas se guarda para los dos.</p>
        </div>
    </div>

    <div class="calendar-section">
        <div class="calendar-header">
            <button class="btn-nav" onclick="changeMonth(-1)">‚ùÆ</button>
            <h3 id="monthYear"></h3>
            <button class="btn-nav" onclick="changeMonth(1)">‚ùØ</button>
        </div>
        <div class="days-grid" id="calendarGrid"></div>
    </div>

    <div class="uke-section">
        <h2 style="color:#e0c0a0; margin-bottom:15px; font-family: 'Georgia', serif;">Ukelele Pro üé∏</h2>
        <div class="chord-selectors">
            <button class="chord-btn active" onclick="setChord('C')">C</button>
            <button class="chord-btn" onclick="setChord('G')">G</button>
            <button class="chord-btn" onclick="setChord('F')">F</button>
            <button class="chord-btn" onclick="setChord('Am')">Am</button>
            <button class="chord-btn" onclick="setChord('Dm')">Dm</button>
            <button class="chord-btn" onclick="setChord('Em')">Em</button>
            <button class="chord-btn" onclick="setChord('A')">A</button>
            <button class="chord-btn" onclick="setChord('D')">D</button>
            <button class="chord-btn" onclick="setChord('E7')">E7</button>
            <button class="chord-btn" onclick="setChord('G7')">G7</button>
            <button class="chord-btn" onclick="setChord('C7')">C7</button>
            <button class="chord-btn" onclick="setChord('Bb')">Bb</button>
        </div>
        <div class="fretboard" id="fretboard">
            <div class="fret-line" style="left: 25%"></div>
            <div class="fret-line" style="left: 50%"></div>
            <div class="fret-line" style="left: 75%"></div>
            <div class="string" data-s="3" data-f="0"> <div class="finger-dot" style="left:12.5%" data-show="1"></div> <div class="finger-dot" style="left:37.5%" data-show="2"></div> <div class="finger-dot" style="left:62.5%" data-show="3"></div> <div class="finger-dot" style="left:87.5%" data-show="4"></div> </div>
            <div class="string" data-s="2" data-f="0"> <div class="finger-dot" style="left:12.5%" data-show="1"></div> <div class="finger-dot" style="left:37.5%" data-show="2"></div> <div class="finger-dot" style="left:62.5%" data-show="3"></div> <div class="finger-dot" style="left:87.5%" data-show="4"></div> </div>
            <div class="string" data-s="1" data-f="0"> <div class="finger-dot" style="left:12.5%" data-show="1"></div> <div class="finger-dot" style="left:37.5%" data-show="2"></div> <div class="finger-dot" style="left:62.5%" data-show="3"></div> <div class="finger-dot" style="left:87.5%" data-show="4"></div> </div>
            <div class="string" data-s="0" data-f="0"> <div class="finger-dot" style="left:12.5%" data-show="1"></div> <div class="finger-dot" style="left:37.5%" data-show="2"></div> <div class="finger-dot" style="left:62.5%" data-show="3"></div> <div class="finger-dot" style="left:87.5%" data-show="4"></div> </div>
        </div>
    </div>

    <div class="tarot-section">
        <h2>üîÆ Ga-Tarot del D√≠a</h2>
        <p style="font-size: 0.9rem; color:#aaa;">Toca la carta para ver qu√© dicen los michis hoy</p>
        
        <div class="tarot-container" onclick="flipCard()">
            <div class="tarot-card" id="dailyCard">
                <div class="card-face card-back"></div>
                <div class="card-face card-front">
                    <div class="tarot-image-container">
                        <img id="tarotImageSrc" class="tarot-image-actual" src="" alt="Michi Tarot">
                    </div>
                    <div class="tarot-name" id="tarotName"></div>
                    <div class="tarot-meaning" id="tarotMeaning"></div>
                </div>
            </div>
        </div>
        <p id="tarot-date" style="margin-top:20px; font-size: 0.8rem; color:#666;"></p>
    </div>

    <div id="noteModal">
        <div class="modal-content">
            <h3 id="modalDateTitle">Fecha</h3>
            <textarea id="noteText" placeholder="Escribe aqu√≠..."></textarea>
            <div>
                <button class="btn-nav" onclick="closeModal()">Cerrar</button>
                <button class="btn-nav" style="background:#d400ff; color:white;" onclick="saveNote()">Guardar ‚òÅÔ∏è</button>
            </div>
        </div>
    </div>

    <div id="music-player">
        <span class="song-info" id="songTitle">M√∫sica</span>
        <div class="controls">
            <button onclick="prevSong()">‚èÆ</button>
            <button onclick="togglePlay()" id="playBtn">‚ñ∂</button>
            <button onclick="nextSong()">‚è≠</button>
        </div>
        <audio id="audioPlayer"></audio>
    </div>

    <script>
        // --- 1. FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyCvzZNhb97ABzhKalhPppHwcfUMG5lGVyg",
            authDomain: "regalo-sofi-31bd7.firebaseapp.com",
            databaseURL: "https://regalo-sofi-31bd7-default-rtdb.firebaseio.com",
            projectId: "regalo-sofi-31bd7",
            storageBucket: "regalo-sofi-31bd7.firebasestorage.app",
            messagingSenderId: "896831826087",
            appId: "1:896831826087:web:d9a067f38828a5c1eb1382"
        };
        try { firebase.initializeApp(firebaseConfig); var database = firebase.database(); } 
        catch (e) { console.error("Error Firebase", e); }

        // --- 2. AUDIO INIT ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function startExperience() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            document.getElementById('start-screen').style.opacity = '0';
            setTimeout(() => { document.getElementById('start-screen').style.display = 'none'; }, 1000);
            init3D();
        }

        // --- 3. UKELELE L√ìGICA ---
        const openFreqs = [440.00, 329.63, 261.63, 392.00]; 
        const chords = {
            'C':  [3, 0, 0, 0], 'G':  [2, 3, 2, 0], 'F':  [0, 1, 0, 2], 'Am': [0, 0, 0, 2],
            'Dm': [0, 1, 2, 2], 'Em': [2, 3, 4, 0], 'A':  [0, 0, 1, 2], 'D':  [0, 2, 2, 2],
            'E7': [2, 0, 2, 1], 'G7': [2, 1, 2, 0], 'C7': [1, 0, 0, 0], 'Bb': [1, 1, 2, 3]
        };
        let currentShape = chords['C'];

        function setChord(name) {
            currentShape = chords[name];
            document.querySelectorAll('.chord-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            const strings = document.querySelectorAll('.string');
            strings.forEach((str, i) => {
                const logicIdx = 3 - i; const fret = currentShape[logicIdx];
                str.querySelectorAll('.finger-dot').forEach(d => d.style.display = 'none');
                str.setAttribute('data-f', fret);
                if(fret > 0) {
                    const dot = str.querySelector(`.finger-dot[data-show="${fret}"]`);
                    if(dot) dot.style.display = 'block';
                }
            });
        }
        setTimeout(() => setChord('C'), 500);

        function playString(idx) {
            const fret = currentShape[idx]; const freq = openFreqs[idx] * Math.pow(2, fret/12);
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = 'triangle'; osc.frequency.value = freq;
            osc.connect(gain); gain.connect(audioCtx.destination);
            const now = audioCtx.currentTime;
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.4, now + 0.02);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);
            osc.start(now); osc.stop(now + 1.5);
            const visualIdx = 3 - idx; 
            const strEl = document.querySelectorAll('.string')[visualIdx];
            if(strEl) { strEl.classList.add('vibrating'); setTimeout(() => strEl.classList.remove('vibrating'), 200); }
        }

        const fretboard = document.getElementById('fretboard');
        fretboard.addEventListener('mousemove', (e) => { if(e.buttons === 1) checkStrum(e); });
        fretboard.addEventListener('touchmove', (e) => { e.preventDefault(); checkStrum(e.touches[0]); }, {passive:false});

        function checkStrum(pointer) {
            const el = document.elementFromPoint(pointer.clientX, pointer.clientY);
            if(el && el.classList.contains('string') && !el.classList.contains('vibrating')) {
                playString(parseInt(el.getAttribute('data-s')));
            }
        }
        document.querySelectorAll('.string').forEach(s => {
            s.addEventListener('mousedown', () => playString(parseInt(s.getAttribute('data-s'))));
        });

        // --- 4. CALENDARIO ---
        let currentDate = new Date();
        const monthYearEl = document.getElementById('monthYear');
        const calendarGrid = document.getElementById('calendarGrid');
        const modal = document.getElementById('noteModal');
        const noteText = document.getElementById('noteText');
        let selectedDateKey = null; let allNotes = {};
        if(database) { database.ref('calendario_notas').on('value', (s) => { allNotes = s.val() || {}; renderCalendar(); }); }

        function renderCalendar() {
            const year = currentDate.getFullYear(); const month = currentDate.getMonth();
            monthYearEl.innerText = new Date(year, month).toLocaleString('es-ES', { month: 'long', year: 'numeric' });
            calendarGrid.innerHTML = '';
            ['D','L','M','X','J','V','S'].forEach(d => { const el = document.createElement('div'); el.innerText = d; el.style.color='#777'; calendarGrid.appendChild(el); });
            const firstDay = new Date(year, month, 1).getDay();
            for(let i=0; i<firstDay; i++) calendarGrid.appendChild(document.createElement('div'));
            const daysInMonth = new Date(year, month + 1, 0).getDate(); const today = new Date();
            for(let i=1; i<=daysInMonth; i++) {
                const cell = document.createElement('div'); cell.className = 'day-cell'; cell.innerText = i;
                const key = `${i}-${month}-${year}`;
                if(i===today.getDate() && month===today.getMonth()) cell.classList.add('today');
                if(allNotes[key]) cell.classList.add('has-note');
                cell.onclick = () => { selectedDateKey = key; document.getElementById('modalDateTitle').innerText = key.replace(/-/g, '/'); noteText.value = allNotes[key] || ''; modal.style.display = 'flex'; };
                calendarGrid.appendChild(cell);
            }
        }
        function changeMonth(d) { currentDate.setMonth(currentDate.getMonth()+d); renderCalendar(); }
        function closeModal() { modal.style.display = 'none'; }
        function saveNote() {
            const val = noteText.value.trim();
            if(val) database.ref('calendario_notas/'+selectedDateKey).set(val); else database.ref('calendario_notas/'+selectedDateKey).remove();
            closeModal();
        }
        renderCalendar();

        // --- 5. GA-TAROT (CON TUS FOTOS) ---
        // Aqu√≠ est√°n los nombres exactos que me diste
        const deck = [
            { 
                image: "Michichay.jpeg", // El Protagonista
                name: "El Protagonista", 
                meaning: "Como Michichay, hoy eres el centro de la historia. Todo gira a tu favor. ¬°Brilla con tu luz propia!" 
            },
            { 
                image: "Fotooo.jpeg", // ELLA - La Carta M√°s Poderosa
                name: "La Musa (T√∫)", 
                meaning: "La carta m√°s bella de la baraja. Hoy irradias arte, inspiraci√≥n y poder. El universo est√° enamorado de ti." 
            },
            { 
                image: "Gato Drogo.jpeg", // El Loco / High
                name: "El Gato Drogo", 
                meaning: "Est√°s un poco en las nubes hoy, y est√° bien. Es un d√≠a para so√±ar despierta, re√≠rte de la nada y lokuraaa hfweebew." 
            },
            { 
                image: "Gato Cachondo.jpeg", // La Pasi√≥n
                name: "Pura Pasi√≥n", 
                meaning: "Hay fuego en el aire hoy por eso estas encerrado por cachondo. Te sientes magn√©tica e irresistible. Cuidado con lo que deseas, que se cumple." 
            },
            { 
                image: "Trio bandido.jpeg", // 3 de Copas / Amistad
                name: "Los C√≥mplices", 
                meaning: "La banda de extorsionadores m√°s buscada de todo Bre√±a. Un d√≠a perfecto para planear algo divertido." 
            },
            { 
                image: "Gato pingui√±o.jpeg", // Autenticidad
                name: "El Elegante", 
                meaning: "Aunque a veces te sientas rara, tienes un estilo √∫nico. Acepta tu rareza hoy, es tu superpoder BROER MI KUATRII." 
            },
            { 
                image: "Gato berrako.jpeg", // La Fuerza
                name: "La Jefa", 
                meaning: "Hoy mandas t√∫. Nadie te puede decir qu√© hacer. Berrakeria y flow por todos lados DIAVLOOO." 
            }
        ];

        function getDailyCard() {
            const dateStr = new Date().toDateString();
            let hash = 0;
            for (let i = 0; i < dateStr.length; i++) hash = dateStr.charCodeAt(i) + ((hash << 5) - hash);
            const index = Math.abs(hash) % deck.length;
            return deck[index];
        }

        function flipCard() {
            const cardEl = document.getElementById('dailyCard');
            if (cardEl.classList.contains('flipped')) return;
            const cardData = getDailyCard();
            document.getElementById('tarotImageSrc').src = cardData.image; 
            document.getElementById('tarotName').innerText = cardData.name;
            document.getElementById('tarotMeaning').innerText = cardData.meaning;
            cardEl.classList.add('flipped');
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('tarot-date').innerText = "Predicci√≥n gatuna para el " + new Date().toLocaleDateString('es-ES', options);
        }

        // --- 6. 3D UNIVERSO REALISTA ---
        let camera, scene, renderer, controls, wordGroup, starField;
        const container = document.getElementById('scene-container');
        
        function createStarTexture() {
            const c = document.createElement('canvas'); c.width=64; c.height=64;
            const ctx = c.getContext('2d');
            const g = ctx.createRadialGradient(32,32,0,32,32,32);
            g.addColorStop(0,'rgba(255,255,255,1)'); g.addColorStop(0.3,'rgba(220,220,255,0.6)'); g.addColorStop(1,'rgba(0,0,0,0)');
            ctx.fillStyle=g; ctx.fillRect(0,0,64,64);
            return new THREE.CanvasTexture(c);
        }

        function init3D() {
            if(renderer) return; 
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0015);
            camera = new THREE.PerspectiveCamera(60, container.clientWidth/container.clientHeight, 0.1, 3000);
            camera.position.z = 800;
            renderer = new THREE.WebGLRenderer({alpha:true, antialias:true});
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping=true; controls.enablePan=false; 
            controls.enableZoom=true; controls.minDistance=300; controls.maxDistance=1500;
            controls.autoRotate=true; controls.autoRotateSpeed=0.3;
            controls.addEventListener('start', () => controls.autoRotate = false);

            const geo = new THREE.BufferGeometry(); const pos = []; const sizes = [];
            for(let i=0; i<5000; i++) {
                pos.push((Math.random()-0.5)*3000, (Math.random()-0.5)*3000, (Math.random()-0.5)*3000);
                sizes.push(Math.random()*3+0.5);
            }
            geo.setAttribute('position', new THREE.Float32BufferAttribute(pos, 3));
            geo.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1));
            const mat = new THREE.PointsMaterial({color:0xffffff, size:4, map:createStarTexture(), transparent:true, blending:THREE.AdditiveBlending, depthWrite:false, sizeAttenuation:true});
            starField = new THREE.Points(geo, mat);
            scene.add(starField);
            createSofi(); animate();
        }

        function createSofi() {
            wordGroup = new THREE.Group();
            const matL = new THREE.LineBasicMaterial({color:0xff00ff, opacity:0.8, transparent:true});
            const matP = new THREE.PointsMaterial({color:0xffffff, size:5, map:createStarTexture(), transparent:true, blending:THREE.AdditiveBlending});
            function addLetter(pts, x) {
                const g = new THREE.BufferGeometry().setFromPoints(pts);
                const l = new THREE.Line(g, matL); l.position.x=x;
                const p = new THREE.Points(g, matP); p.position.x=x;
                wordGroup.add(l, p);
            }
            const h=30, w=20;
            addLetter([new THREE.Vector3(w,h,0), new THREE.Vector3(0,h,0), new THREE.Vector3(0,0,0), new THREE.Vector3(w,0,0), new THREE.Vector3(w,-h,0), new THREE.Vector3(0,-h,0)], -60);
            addLetter([new THREE.Vector3(0,h,0), new THREE.Vector3(w,h,0), new THREE.Vector3(w,-h,0), new THREE.Vector3(0,-h,0), new THREE.Vector3(0,h,0)], -30);
            addLetter([new THREE.Vector3(w,h,0), new THREE.Vector3(0,h,0), new THREE.Vector3(0,-h,0)], 10); addLetter([new THREE.Vector3(0,0,0), new THREE.Vector3(w*0.7,0,0)], 10);
            addLetter([new THREE.Vector3(0,h,0), new THREE.Vector3(0,-h,0)], 40);

            wordGroup.rotation.set(Math.random()*Math.PI*2, Math.random()*Math.PI*2, Math.random()*Math.PI*2);
            wordGroup.position.set((Math.random()-0.5)*1000, (Math.random()-0.5)*1000, (Math.random()-0.5)*1000);
            scene.add(wordGroup);
        }
        function animate() { requestAnimationFrame(animate); controls.update(); if(starField) starField.rotation.y += 0.0002; renderer.render(scene, camera); }
        window.addEventListener('resize', () => { if(camera){ camera.aspect = container.clientWidth/container.clientHeight; camera.updateProjectionMatrix(); renderer.setSize(container.clientWidth, container.clientHeight); }});

        // 7. PLAYER M√öSICA ACTUALIZADO
        const playlist = [ 
            {title:"Taxi", file:"Taxi.mp3"}, 
            {title:"Enamorado", file:"Enamorado.mp3"},
            {title:"Flores", file:"Flores.mp3"},
            {title:"Hecho para ti", file:"Hechoparati.mp3"},
            {title:"No digas nada", file:"Nodigasnada.mp3"},
            {title:"NeoRoneo", file:"NeoRoneo.mp3"}
        ];
        let currSong = 0; const player = document.getElementById('audioPlayer'); let isPlaying = false;
        function togglePlay() {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            if(!playlist.length) return; if(!player.src) player.src = playlist[0].file;
            if(isPlaying) { player.pause(); document.getElementById('playBtn').innerText="‚ñ∂"; }
            else { player.play(); document.getElementById('playBtn').innerText="‚è∏"; }
            isPlaying = !isPlaying;
        }
        function nextSong() { currSong = (currSong+1)%playlist.length; player.src = playlist[currSong].file; document.getElementById('songTitle').innerText = playlist[currSong].title; if(isPlaying) player.play(); }
        function prevSong() { currSong = (currSong-1+playlist.length)%playlist.length; player.src = playlist[currSong].file; document.getElementById('songTitle').innerText = playlist[currSong].title; if(isPlaying) player.play(); }
    </script>
</body>
</html>
