<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Universo de Sofi</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- ESTILOS GENERALES --- */
        body { 
            margin: 0; 
            background-color: #050505; 
            color: white; 
            font-family: 'Segoe UI', sans-serif; 
            overflow-x: hidden;
        }

        /* --- CONTENEDOR 3D --- */
        #scene-container {
            width: 85%;
            height: 450px;
            margin: 40px auto;
            position: relative;
            border: 1px solid #333;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(212, 0, 255, 0.1); 
            cursor: grab;
        }
        #scene-container:active { cursor: grabbing; }

        .instruction {
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            margin-top: -30px;
            margin-bottom: 50px;
        }

        /* --- SECCIÓN CARTAS --- */
        .bottom-section {
            display: flex;
            justify-content: space-between;
            width: 85%;
            margin: 0 auto 50px auto;
            gap: 20px;
        }
        .card {
            background: #0f0f0f;
            border: 1px solid #222;
            padding: 25px;
            width: 48%;
            border-radius: 15px;
        }
        h2 { color: #d400ff; margin-top: 0; font-size: 1.4rem; }
        p { line-height: 1.6; color: #ccc; font-size: 0.95rem; }

        /* --- CALENDARIO ESTILO ESPACIAL --- */
        .calendar-section {
            width: 85%;
            margin: 0 auto 100px auto;
            background: #0f0f0f;
            border: 1px solid #222;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-header h3 { margin: 0; color: #fff; font-size: 1.5rem; text-transform: capitalize; }
        
        .btn-nav {
            background: #222;
            color: #d400ff;
            border: 1px solid #d400ff;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-nav:hover { background: #d400ff; color: white; }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            text-align: center;
        }

        .day-name { color: #888; font-weight: bold; padding-bottom: 10px; }
        
        .day-cell {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
            min-height: 40px;
            transition: 0.2s;
        }
        
        .day-cell:hover { background: #2a2a2a; border: 1px solid #555; }
        .day-cell.today { border: 1px solid #d400ff; color: #d400ff; font-weight: bold; }
        
        /* Indicador de que hay nota */
        .has-note::after {
            content: '★';
            position: absolute;
            top: 5px;
            right: 5px;
            color: #ffd700;
            font-size: 0.8rem;
        }

        /* --- MODAL PARA ESCRIBIR NOTA --- */
        #noteModal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #151515;
            padding: 30px;
            border-radius: 10px;
            width: 300px;
            border: 1px solid #d400ff;
            text-align: center;
        }
        textarea {
            width: 100%;
            height: 100px;
            background: #222;
            color: white;
            border: 1px solid #444;
            margin: 15px 0;
            border-radius: 5px;
            padding: 10px;
            box-sizing: border-box;
        }
        .btn-save { background: #d400ff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; }
        .btn-close { background: transparent; color: #888; border: 1px solid #555; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-right: 10px; }

        /* --- REPRODUCTOR --- */
        #music-player {
            position: fixed; bottom: 20px; left: 20px;
            background: rgba(15, 15, 15, 0.95);
            border: 1px solid #d400ff;
            padding: 10px 20px;
            border-radius: 50px;
            z-index: 1000;
            display: flex; align-items: center; gap: 15px;
            box-shadow: 0 0 15px rgba(212, 0, 255, 0.2);
        }
        .controls button { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; }
        .controls button:hover { color: #d400ff; }
        .song-info { font-size: 0.85rem; max-width: 120px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #d400ff; }

        @media (max-width: 768px) {
            .bottom-section { flex-direction: column; }
            .card, .calendar-section { width: 90%; box-sizing: border-box; }
            #music-player { left: 5%; width: 80%; justify-content: space-between; border-radius: 15px; }
        }
    </style>
</head>
<body>

    <div id="scene-container"></div>
    <p class="instruction">✨ Encuentra tu nombre en las estrellas ✨</p>

    <div class="bottom-section">
        <div class="card">
            <h2>Para Sofi</h2>
            <p>Este es tu pequeño rincón en internet. Arriba tienes un universo para explorar.</p>
            <p>Abajo tienes un calendario. Úsalo para anotar nuestros días especiales o cómo te sientes hoy.</p>
        </div>
        <div class="card">
            <h2>Música & Recuerdos</h2>
            <p>Dale play a la música para acompañar el viaje.</p>
            <p>Te amo hasta la estrella más lejana que ves ahí arriba.</p>
        </div>
    </div>

    <div class="calendar-section">
        <div class="calendar-header">
            <button class="btn-nav" onclick="changeMonth(-1)">❮</button>
            <h3 id="monthYear"></h3>
            <button class="btn-nav" onclick="changeMonth(1)">❯</button>
        </div>
        <div class="days-grid" id="calendarGrid">
            </div>
    </div>

    <div id="noteModal">
        <div class="modal-content">
            <h3 id="modalDateTitle">Fecha</h3>
            <textarea id="noteText" placeholder="Escribe algo bonito aquí..."></textarea>
            <div>
                <button class="btn-close" onclick="closeModal()">Cerrar</button>
                <button class="btn-save" onclick="saveNote()">Guardar ★</button>
            </div>
        </div>
    </div>

    <div id="music-player">
        <div class="song-info">
            <span id="songTitle">Elige canción...</span>
        </div>
        <div class="controls">
            <button onclick="prevSong()">⏮</button>
            <button onclick="togglePlay()" id="playBtn">▶</button>
            <button onclick="nextSong()">⏭</button>
        </div>
        <audio id="audioPlayer"></audio>
    </div>

    <script>
        // --- MÚSICA (RECUERDA CAMBIAR LOS NOMBRES) ---
        const playlist = [
            { title: "Canción 1", file: "cancion1.mp3" },
            { title: "Canción 2", file: "cancion2.mp3" }
        ];
        
        let currentSongIndex = 0;
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.getElementById('playBtn');
        const titleLabel = document.getElementById('songTitle');
        let isPlaying = false;

        function loadSong(index) {
            if(playlist.length === 0) return;
            audioPlayer.src = playlist[index].file;
            titleLabel.innerText = playlist[index].title;
        }

        function togglePlay() {
            if (playlist.length === 0) return alert("Sube canciones al repo");
            if (!audioPlayer.src) loadSong(0);
            
            if (isPlaying) { audioPlayer.pause(); playBtn.innerText = "▶"; }
            else { audioPlayer.play(); playBtn.innerText = "⏸"; }
            isPlaying = !isPlaying;
        }

        function nextSong() {
            currentSongIndex = (currentSongIndex + 1) % playlist.length;
            loadSong(currentSongIndex);
            if(isPlaying) audioPlayer.play();
        }
        function prevSong() {
            currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
            loadSong(currentSongIndex);
            if(isPlaying) audioPlayer.play();
        }

        // --- CALENDARIO LÓGICA ---
        let currentDate = new Date();
        const monthYearEl = document.getElementById('monthYear');
        const calendarGrid = document.getElementById('calendarGrid');
        const modal = document.getElementById('noteModal');
        const noteText = document.getElementById('noteText');
        let selectedDateKey = null;

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // Nombre del mes
            monthYearEl.innerText = new Date(year, month).toLocaleString('es-ES', { month: 'long', year: 'numeric' });
            
            calendarGrid.innerHTML = '';
            
            // Días de la semana
            const weekDays = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];
            weekDays.forEach(day => {
                const div = document.createElement('div');
                div.className = 'day-name';
                div.innerText = day;
                calendarGrid.appendChild(div);
            });

            // Días vacíos al inicio
            const firstDayIndex = new Date(year, month, 1).getDay();
            for(let i=0; i<firstDayIndex; i++){
                calendarGrid.appendChild(document.createElement('div'));
            }

            // Días del mes
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const today = new Date();

            for(let i=1; i<=daysInMonth; i++){
                const dayEl = document.createElement('div');
                dayEl.className = 'day-cell';
                dayEl.innerText = i;
                
                // Clave única para guardar nota: "14-2-2024"
                const dateKey = `${i}-${month}-${year}`;
                
                // Si es hoy
                if(i === today.getDate() && month === today.getMonth() && year === today.getFullYear()){
                    dayEl.classList.add('today');
                }

                // Si tiene nota guardada
                if(localStorage.getItem(dateKey)) {
                    dayEl.classList.add('has-note');
                }

                dayEl.onclick = () => openModal(i, month, year);
                calendarGrid.appendChild(dayEl);
            }
        }

        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        function openModal(day, month, year) {
            selectedDateKey = `${day}-${month}-${year}`;
            document.getElementById('modalDateTitle').innerText = `${day} / ${month+1} / ${year}`;
            
            // Cargar nota si existe
            noteText.value = localStorage.getItem(selectedDateKey) || '';
            
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function saveNote() {
            if(noteText.value.trim() === "") {
                localStorage.removeItem(selectedDateKey);
            } else {
                localStorage.setItem(selectedDateKey, noteText.value);
            }
            closeModal();
            renderCalendar(); // Recargar para mostrar/quitar la estrellita
        }

        // Iniciar calendario
        renderCalendar();


        // --- 3D THREE.JS (SOFI ALEATORIO) ---
        let camera, scene, renderer, controls, wordGroup;
        const container = document.getElementById('scene-container');

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.0015);

            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 2000);
            camera.position.z = 500;

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.enableZoom = false;

            // Estrellas fondo
            const starGeo = new THREE.BufferGeometry();
            const starPos = [];
            for(let i=0; i<3000; i++) {
                starPos.push(THREE.MathUtils.randFloatSpread(2000), THREE.MathUtils.randFloatSpread(2000), THREE.MathUtils.randFloatSpread(2000));
            }
            starGeo.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
            const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0x888888, size: 1.5}));
            scene.add(stars);

            createSofi();
            window.addEventListener('resize', () => {
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            });
        }

        function createSofi() {
            wordGroup = new THREE.Group();
            const matLine = new THREE.LineBasicMaterial({color: 0xd400ff, opacity: 0.8, transparent: true});
            const matDot = new THREE.PointsMaterial({color: 0xffffff, size: 4});

            function addLetter(pts, xOff) {
                const geo = new THREE.BufferGeometry().setFromPoints(pts);
                const l = new THREE.Line(geo, matLine);
                const s = new THREE.Points(geo, matDot);
                l.position.x = xOff; s.position.x = xOff;
                wordGroup.add(l, s);
            }

            const h=40, w=30;
            // S
            addLetter([new THREE.Vector3(w,h,0), new THREE.Vector3(0,h,0), new THREE.Vector3(0,0,0), new THREE.Vector3(w,0,0), new THREE.Vector3(w,-h,0), new THREE.Vector3(0,-h,0)], -80);
            // O
            addLetter([new THREE.Vector3(0,h,0), new THREE.Vector3(w,h,0), new THREE.Vector3(w,-h,0), new THREE.Vector3(0,-h,0), new THREE.Vector3(0,h,0)], -30);
            // F
            addLetter([new THREE.Vector3(w,h,0), new THREE.Vector3(0,h,0), new THREE.Vector3(0,-h,0)], 20);
            addLetter([new THREE.Vector3(0,0,0), new THREE.Vector3(w*0.7,0,0)], 20);
            // I
            addLetter([new THREE.Vector3(0,h,0), new THREE.Vector3(0,-h,0)], 70);

            // Aleatoriedad
            wordGroup.rotation.set(Math.random()*6, Math.random()*6, Math.random()*6);
            wordGroup.position.set(Math.random()*400-200, Math.random()*400-200, Math.random()*400-200);
            scene.add(wordGroup);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
